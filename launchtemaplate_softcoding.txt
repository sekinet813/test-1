Feature: Create resources for K8s as "Authenticated User"
  As a user
  I need to create a deployment

  @api
  Scenario: Log into the site
    Given I am logged in as user "{{ user_name }}"
    When I visit "/clouds"
    Then I should see the heading "Cloud service providers"
    And I should see the link "All" in the "nav_bar"
    And I should see the link "K8s" in the "nav_bar"


  @api @javascript
  Scenario: Create a Launch template(git)
    Given I am logged in as user "{{ user_name }}"
    When I visit "clouds/design/server_template/{{ cloud_context }}/k8s/add"
    And I enter "{{ launch_git_repository }}" for "Git repository"
    And I click "{{ launch_configuration_git }}"
    And I wait "{{ wait }}" milliseconds
    And I click "{{ launch_credentials }}"
    And I enter "{{ launch_name_git }}" for "Name"
    And I select "{{ namespace }}" from "Namespace"
    And I select "{{ launch_git_source_type }}" from "Source type"
    And I enter "{{ launch_git_resource_path }}" for "Git resource path"
    And I select "{{ launch_workflow_status }}" from "Workflow status"
    And I select "{{ launch_git_branch_or_tag }}" from "Git branch or tag"
    And I press "Save"
    And I wait for AJAX to finish
    And I should see "has been created"


  @api @javascript
  Scenario: Launch a Launch template(git)
    Given I am logged in as user "{{ user_name }}"
    When I visit "/clouds/design/server_template/{{ cloud_context }}"
    And I click "{{ launch_name_git }}"
    And I click "Launch"
    And I press "Launch"
    And I wait for AJAX to finish
    And I should see "has been launched"


  @api @javascript
  Scenario: Create a Launch template(yaml)
    Given I am logged in as user "{{ user_name }}"
    When I visit "clouds/design/server_template/{{ cloud_context }}/k8s/add"
    And I enter "{{ launch_name_yaml }}" for "Name"
    And I select "{{ namespace }}" from "Namespace"
    And I click "{{ launch_configuration_yaml }}"
    And I enter "{{ launch_yaml_repository }}" for "YAML URL"
    And I select "{{ launch_workflow_status }}" from "Workflow status"
    And I press "Save"
    And I wait for AJAX to finish
    And I should see "has been created"


  @api @javascript
  Scenario: Launch a Launch template(yaml)
    Given I am logged in as user "{{ user_name }}"
    When I visit "/clouds/design/server_template/{{ cloud_context }}"
    And I click "{{ launch_name_yaml }}"
    And I click "Launch"
    And I press "Launch"
    And I wait for AJAX to finish
    And I should see "has been launched"
